#!/bin/bash

#set -e
# Based on Jorge's askubuntu post: 
# http://askubuntu.com/questions/403618/how-do-i-clean-up-a-machine-after-using-the-local-provider/403619#403619
set -x 

# Find all the lxc containers.
for container in $(sudo lxc-ls)
do
  sudo lxc-stop --name ${container}
  # Remove each container.
  sudo lxc-destroy --name ${container}
done

for jujudaemon in $(sudo initctl list | grep juju | cut -d ' ' -f 1)
do
    sudo stop ${jujudaemon}
done

sudo rm -v /etc/init/juju-*
sudo rm -v /etc/lxc/auto/$USER-*
sudo rm -v /etc/rsyslog.d/25-juju*
sudo rm -vrf /var/lib/juju/containers/$USER-*
sudo rm -vrf /var/lib/juju/locks/*
sudo rm -v /var/lib/lxc/juju-*
echo 'If your home directory is encrypted your local files are kept in /var/tmp/juju'
sudo rm -vrf $HOME/.juju/local
sudo rm -v $HOME/.juju/environments/local.jenv
echo 'Removing the cloud images from /var/cache/lxc/cloud-*'
sudo rm -vrf /var/cache/lxc/cloud-{precise,trusty,utopic}/*
